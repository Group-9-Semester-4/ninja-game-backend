<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Statistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <style>
        .graph-wide {
            position: relative;
            height: 30vh;
            width: 80vw;
            padding: 1em;
        }
    </style>
</head>
<body>
<h2> Welcome to statistics.</h2>
<p> Here you can find information about the games being played.</p>
<p> As of now, we keep track of which cards are discarded (at the beginning of the game, players can choose to discard
    them). And which cards are redrawn,
    (during gameplay, players can choose to "skip" certain cards - redraw a different one).</p>
<div class="graph-wide"><canvas id="discarded_graph"></canvas></div>
<div class="graph-wide"><canvas id="redrawn_graph"></canvas></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.2.1/dist/chart.min.js"></script>
<script th:inline="javascript">
    var card_discarded_map = /*[[${discards}]]*/ {};
    console.log(card_discarded_map);
    var card_redrawn_map = /*[[${redraws}]]*/ {};
    console.log(card_redrawn_map);
</script>
<script>
    // Say "No data" if the dataset is empty.
    const no_data_plugin = {
        id: 'no-data',
        beforeDraw(chart) {
            if (chart.data.datasets[0].data.length === 0) {
                // No data is present
                let ctx = chart.ctx;
                let width = chart.width;
                let height = chart.height
                chart.clear();

                ctx.save();
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = "16px normal 'Helvetica Nueue'";
                ctx.fillText('No data to display', width / 2, height / 2);
                ctx.restore();
            }
        }
    };
    // rendering the canvas
    var ctxDiscarded = document.getElementById('discarded_graph').getContext('2d');
    var discarded_chart = new Chart(ctxDiscarded, {
        type: 'bar',
        data: {
            labels: Object.keys(card_discarded_map),
            datasets: [{
                label: 'Number of discards',
                data: Object.values(card_discarded_map),
                backgroundColor: 'rgb(255,174,174)',
                borderColor: 'rgb(33,33,33)',
                borderWidth: 1
            }]
        },
        options: {
            responsive:  true,
            maintainAspectRatio: false,

            indexAxis: 'y',
            plugins: {
                title: {
                    display: true,
                    text: 'Card discards',
                    padding: {
                        top: 10,
                        bottom: 10
                    }
                },
                legend: {
                    onClick: (e) => e, // Stopping unwanted default behavior (hides labels on click)
                    labels: {
                        font: {
                            family: "Helvetica"
                        }
                    }
                },
            },
            scale: {
                ticks: {
                    precision: 0
                }
            }
        },
        plugins: [no_data_plugin]
    });
    var ctxRedrawn = document.getElementById('redrawn_graph').getContext('2d');
    var redrawn_chart = new Chart(ctxRedrawn, {
        type: 'bar',
        data: {
            labels: Object.keys(card_redrawn_map),
            datasets: [{
                label: 'Number of redraws',
                data: Object.values(card_redrawn_map),
                backgroundColor: 'rgb(117,207,236)',
                borderColor: 'rgb(33,33,33)',
                borderWidth: 1
            }]
        },
        options: {
            responsive:  true,
            maintainAspectRatio: false,

            indexAxis: 'y',
            plugins: {
                title: {
                    display: true,
                    text: 'Card redraws',
                    padding: {
                        top: 10,
                        bottom: 10
                    }
                },
                legend: {
                    onClick: (e) => e, // Stopping unwanted default behavior (hides labels on click)
                },
            },
            scale: {
                ticks: {
                    precision: 0
                }
            }
        },
        plugins: [no_data_plugin]
    });

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
</body>
</html>